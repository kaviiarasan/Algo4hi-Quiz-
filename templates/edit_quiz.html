{% extends "base.html" %}

{% block title %}Edit Quiz - Admin{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-edit me-2 text-warning"></i>Edit Quiz: {{ quiz.title }}
            </h2>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
            </a>
        </div>

        <form method="POST" id="editQuizForm">
            <!-- Quiz Details -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Quiz Details</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label">Quiz Title</label>
                            <input type="text" name="title" class="form-control" value="{{ quiz.title }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Start Time</label>
                            <input type="datetime-local" name="start_time" class="form-control" 
                                   value="{{ quiz.start_time.strftime('%Y-%m-%dT%H:%M') }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">End Time</label>
                            <input type="datetime-local" name="end_time" class="form-control" 
                                   value="{{ quiz.end_time.strftime('%Y-%m-%dT%H:%M') }}" required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 1 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0 text-primary">Question 1</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Question</label>
                        <textarea name="question1" class="form-control" rows="3" required>{{ quiz.question1 }}</textarea>
                    </div>
                    
                    <div id="question1Options">
                        <div class="row">
                            {% for option in quiz.question1_options %}
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Option {{ loop.index }}</label>
                                <input type="text" name="question1_option{{ loop.index }}" 
                                       class="form-control" value="{{ option }}" required>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <button type="button" class="btn btn-sm btn-success" onclick="addOption('question1')">
                            <i class="fas fa-plus me-1"></i>Add Option
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeOption('question1')">
                            <i class="fas fa-minus me-1"></i>Remove Option
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Correct Answer</label>
                        <select name="question1_correct" class="form-select" id="question1Correct" required>
                            {% for i in range(quiz.question1_options|length) %}
                            <option value="{{ i }}" {% if i == quiz.question1_correct %}selected{% endif %}>
                                Option {{ i + 1 }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0 text-primary">Question 2</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Question</label>
                        <textarea name="question2" class="form-control" rows="3" required>{{ quiz.question2 }}</textarea>
                    </div>
                    
                    <div id="question2Options">
                        <div class="row">
                            {% for option in quiz.question2_options %}
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Option {{ loop.index }}</label>
                                <input type="text" name="question2_option{{ loop.index }}" 
                                       class="form-control" value="{{ option }}" required>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <button type="button" class="btn btn-sm btn-success" onclick="addOption('question2')">
                            <i class="fas fa-plus me-1"></i>Add Option
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeOption('question2')">
                            <i class="fas fa-minus me-1"></i>Remove Option
                        </button>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Correct Answer</label>
                        <select name="question2_correct" class="form-select" id="question2Correct" required>
                            {% for i in range(quiz.question2_options|length) %}
                            <option value="{{ i }}" {% if i == quiz.question2_correct %}selected{% endif %}>
                                Option {{ i + 1 }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="text-center">
                <button type="submit" class="btn btn-warning btn-lg">
                    <i class="fas fa-save me-2"></i>Update Quiz
                </button>
            </div>
        </form>
    </div>
</div>

<script>
let question1OptionCount = {{ quiz.question1_options|length }};
let question2OptionCount = {{ quiz.question2_options|length }};

function addOption(questionNum) {
    let optionCount = questionNum === 'question1' ? ++question1OptionCount : ++question2OptionCount;
    if (optionCount > 6) {
        alert('Maximum 6 options allowed');
        if (questionNum === 'question1') question1OptionCount = 6;
        else question2OptionCount = 6;
        return;
    }
    
    let container = document.getElementById(questionNum + 'Options');
    let row = container.querySelector('.row');
    
    let newOption = document.createElement('div');
    newOption.className = 'col-md-6 mb-3';
    newOption.innerHTML = `
        <label class="form-label">Option ${optionCount}</label>
        <input type="text" name="${questionNum}_option${optionCount}" class="form-control" required>
    `;
    row.appendChild(newOption);
    
    // Update correct answer dropdown
    let select = document.getElementById(questionNum + 'Correct');
    let option = document.createElement('option');
    option.value = optionCount - 1;
    option.textContent = `Option ${optionCount}`;
    select.appendChild(option);
}

function removeOption(questionNum) {
    let optionCount = questionNum === 'question1' ? question1OptionCount : question2OptionCount;
    if (optionCount <= 2) {
        alert('Minimum 2 options required');
        return;
    }
    
    if (questionNum === 'question1') question1OptionCount--;
    else question2OptionCount--;
    
    let container = document.getElementById(questionNum + 'Options');
    let row = container.querySelector('.row');
    let lastOption = row.lastElementChild;
    if (lastOption) lastOption.remove();
    
    // Update correct answer dropdown
    let select = document.getElementById(questionNum + 'Correct');
    select.removeChild(select.lastElementChild);
}
</script>
{% endblock %}